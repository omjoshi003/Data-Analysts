----- Boys highest marks
SELECT students.student_name, gender.gender_name, marks.marks_obtained  as math 
FROM marks  
INNER JOIN students ON marks.student_id = students.student_id .
INNER JOIN subject ON marks.subject_id = subject.subject_id .
INNER JOIN class ON class.class_id = students.class_id
INNER JOIN gender ON gender.gender_id = students.gender_id

WHERE 
subject.subject_name = 'Math' and  gender_name = 'male'
ORDER BY
    marks.marks_obtained DESC
LIMIT 1;

 


---between range student countâ€”
SELECT
    CASE 
        WHEN marks.marks_obtained BETWEEN 70 AND 80 THEN '70-80'
        WHEN marks.marks_obtained BETWEEN 80 AND 90 THEN '80-90'
        WHEN marks.marks_obtained BETWEEN 90 AND 100 THEN '90-100'
        ELSE 'Other'
    END AS score,
    COUNT(*) AS number_of_students
FROM
    marks
INNER JOIN
    subject ON marks.subject_id = subject.subject_id
WHERE
    subject.subject_name = 'Math'
GROUP BY
    score
ORDER BY
    score;

 
-- math highest marks from each class
SELECT 
    class.class_std,
    students.student_name,
    marks.marks_obtained AS highest_math_marks
FROM 
    marks
INNER JOIN 
    students ON marks.student_id = students.student_id
INNER JOIN 
    subject ON marks.subject_id = subject.subject_id
INNER JOIN 
    class ON class.class_id = students.class_id
WHERE 
    subject.subject_name = 'Math' 
    -- Subquery to find the highest marks in each class
    AND marks.marks_obtained = (
        SELECT 
            MAX(marks_sub.marks_obtained) 
        FROM 
            marks marks_sub
        INNER JOIN 
            students students_sub ON marks_sub.student_id = students_sub.student_id
        INNER JOIN 
            class class_sub ON students_sub.class_id = class_sub.class_id
        WHERE 
            class_sub.class_std = class.class_std 
            AND marks_sub.subject_id = subject.subject_id
    )    
ORDER BY 
    class.class_std;

 

-- math lowest marks from each class
SELECT 
    class.class_std,
    students.student_name,
    marks.marks_obtained AS highest_math_marks
FROM 
    marks
INNER JOIN 
    students ON marks.student_id = students.student_id
INNER JOIN 
    subject ON marks.subject_id = subject.subject_id
INNER JOIN 
    class ON class.class_id = students.class_id
WHERE 
    subject.subject_name = 'Math' 
    -- Subquery to find the highest marks in each class
    AND marks.marks_obtained = (
        SELECT 
            MIN(marks_sub.marks_obtained) 
        FROM 
            marks marks_sub
        INNER JOIN 
            students students_sub ON marks_sub.student_id = students_sub.student_id
        INNER JOIN 
            class class_sub ON students_sub.class_id = class_sub.class_id
        WHERE 
            class_sub.class_std = class.class_std 
            AND marks_sub.subject_id = subject.subject_id
            AND marks_sub.marks_obtained IS NOT NULL
    )    
ORDER BY 
    class.class_std;
 



-- teacher wise highest marks 
SELECT 
    teacher.teacher_name,
    MAX(marks.marks_obtained) AS highest_marks
FROM 
    marks
INNER JOIN 
    students ON marks.student_id = students.student_id
INNER JOIN 
    subject ON marks.subject_id = subject.subject_id
INNER JOIN 
    teacher ON teacher.teacher_id = subject.teacher_id
GROUP BY 
    teacher.teacher_name;
 

--second highest marks
SELECT
    subject.subject_name,
    MAX(marks.marks_obtained) AS second_highest_marks
FROM
    marks
INNER JOIN
    students ON marks.student_id = students.student_id
INNER JOIN
    subject ON marks.subject_id = subject.subject_id
WHERE
    marks.marks_obtained < (
        SELECT MAX(sub_m.marks_obtained)
        FROM marks sub_m
        INNER JOIN students sub_s ON sub_m.student_id = sub_s.student_id
        INNER JOIN subject sub_su ON sub_m.subject_id = sub_su.subject_id
        WHERE sub_su.subject_name = subject.subject_name
    )
GROUP BY
    subject.subject_name
ORDER BY
    subject.subject_name;
 

-- second  lowest marks --
SELECT 
    subject.subject_name,
    MIN(marks.marks_obtained) AS second_lowest_marks
FROM 
    marks
INNER JOIN 
    students ON marks.student_id = students.student_id
INNER JOIN 
    subject ON marks.subject_id = subject.subject_id
WHERE 
    marks.marks_obtained > (
        SELECT MIN(sub_m.marks_obtained)
        FROM marks sub_m
        INNER JOIN students sub_s ON sub_m.student_id = sub_s.student_id
        INNER JOIN subject sub_su ON sub_m.subject_id = sub_su.subject_id
        WHERE sub_su.subject_name = subject.subject_name
    )
GROUP BY 
    subject.subject_name
ORDER BY 
    subject.subject_name;

 

-- exam year second lowest marks 
SELECT
    exam.exam_year,
    subject.subject_name,
    MIN(marks.marks_obtained) AS second_lowest_marks
FROM
    marks
INNER JOIN
    students ON marks.student_id = students.student_id
INNER JOIN
    subject ON marks.subject_id = subject.subject_id
INNER JOIN
    exam ON marks.exam_id = exam.exam_id
WHERE
    marks.marks_obtained > (
        SELECT MIN(marks_sub.marks_obtained)
        FROM marks AS marks_sub
        INNER JOIN exam AS e_sub ON marks_sub.exam_id = e_sub.exam_id
        INNER JOIN subject AS s_sub ON marks_sub.subject_id = s_sub.subject_id
        WHERE s_sub.subject_name = subject.subject_name
          AND e_sub.exam_year = exam.exam_year
    )
GROUP BY
    exam.exam_year,
    subject.subject_name
ORDER BY
    exam.exam_year,
    subject.subject_name;

 


-- exam year second highest marks 
SELECT
    exam.exam_year,
    subject.subject_name,
    MAX(marks.marks_obtained) AS second_highest_marks
FROM
    marks
INNER JOIN
    students ON marks.student_id = students.student_id
INNER JOIN
    subject ON marks.subject_id = subject.subject_id
INNER JOIN
    exam ON marks.exam_id = exam.exam_id
WHERE
    marks.marks_obtained < (
        SELECT MAX(marks_sub.marks_obtained)
        FROM marks AS marks_sub
        INNER JOIN exam AS exam_sub ON marks_sub.exam_id = exam_sub.exam_id
        INNER JOIN subject AS subject_sub ON marks_sub.subject_id = subject_sub.subject_id
        WHERE subject_sub.subject_name = subject.subject_name
          AND exam_sub.exam_year = exam.exam_year
    )
GROUP BY
    exam.exam_year,
    subject.subject_name
ORDER BY
    exam.exam_year,
    subject.subject_name;


 -- exam year second highest marks
 SELECT
    exam.exam_year,
    subject.subject_name,
    MAX(marks.marks_obtained) AS second_highest_marks
FROM
    marks
INNER JOIN
    students ON marks.student_id = students.student_id
INNER JOIN
    subject ON marks.subject_id = subject.subject_id
INNER JOIN
    exam ON marks.exam_id = exam.exam_id
WHERE
    marks.marks_obtained < (
        SELECT MAX(marks_sub.marks_obtained)
        FROM marks AS marks_sub
        INNER JOIN exam AS e_sub ON marks_sub.exam_id = e_sub.exam_id
        INNER JOIN subject AS s_sub ON marks_sub.subject_id = s_sub.subject_id
        WHERE s_sub.subject_name = subject.subject_name
          AND e_sub.exam_year = exam.exam_year
    )
GROUP BY
    exam.exam_year,
    subject.subject_name
ORDER BY
    exam.exam_year,
    subject.subject_name;
 

